# ツール

ツールは、コマンドラインインターフェイスを提供する Python パッケージです。

!!! note

    ツールインターフェースの操作の概要については、[ツールガイド](../guides/tools.md) を参照してください。このドキュメントでは、ツール管理の詳細について説明します。

## `uv tool` インターフェース

uv には、ツールと対話するための専用インターフェースが含まれています。ツールは、`uv tool run` を使用してインストールせずに呼び出すことができます。その場合、ツールの依存関係は、現在のプロジェクトから分離された一時的な仮想環境にインストールされます。

ツールをインストールせずに実行することは非常に一般的なので、`uv tool run` の別名 `uvx` が提供されています。この 2 つのコマンドはまったく同じです。簡潔にするために、このドキュメントでは主に `uv tool run` ではなく `uvx` を参照します。

ツールは `uv tool install` でインストールすることもできます。その場合、ツールの実行可能ファイルは [`PATH` で利用可能](#the-path) になります。分離された仮想環境は引き続き使用されますが、コマンドが完了しても削除されません。

## 実行とインストール

ほとんどの場合、ツールをインストールするよりも、`uvx` を使用してツールを実行する方が適切です。ツールをインストールすると、システム上の他のプログラムでツールを使用できるようにする必要がある場合に便利です。たとえば、制御していないスクリプトでツールが必要な場合や、Docker イメージ内でツールをユーザーが使用できるようにしたい場合などです。

## ツール環境

`uvx` を使用してツールを実行すると、仮想環境が uv キャッシュ ディレクトリに保存され、使い捨てとして扱われます。つまり、`uv cache clean` を実行すると、環境は削除されます。環境は、繰り返しの呼び出しのオーバーヘッドを削減するためだけにキャッシュされます。環境が削除されると、新しい環境が自動的に作成されます。

`uv tool install` を使用してツールをインストールすると、uv tools ディレクトリに仮想環境が作成されます。ツールをアンインストールしない限り、環境は削除されません。環境を手動で削除すると、ツールは実行できなくなります。

## ツールのバージョン

特定のバージョンが要求されない限り、`uv tool install` は要求されたツールの最新バージョンをインストールします。`uvx` は、_最初の呼び出し時に_ 要求されたツールの最新バージョンを使用します。その後、`uvx` は、別のバージョンが要求されるか、キャッシュが削除されるか、キャッシュが更新されない限り、ツールのキャッシュされたバージョンを使用します。

たとえば、特定のバージョンの Ruff を実行するには、次のようにします:

```console
$ uvx ruff@0.6.0 --version
ruff 0.6.0
```

`uvx` のその後の呼び出しでは、キャッシュされたバージョンではなく、最新のバージョンが使用されます:

```console
$ uvx ruff --version
ruff 0.6.2
```

ただし、Ruff の新しいバージョンがリリースされた場合、キャッシュが更新されない限り使用されません。

Ruff の最新バージョンをリクエストしてキャッシュを更新するには、`@latest` サフィックスを使用します:

```console
$ uvx ruff@latest --version
0.6.2
```

`uv tool install` でツールがインストールされると、`uvx` はデフォルトでインストールされたバージョンを使用します。

たとえば、古いバージョンの Ruff をインストールした後:

```console
$ uv tool install ruff==0.5.0
```

`ruff` と `uvx ruff` のバージョンは同じです:

```console
$ ruff --version
ruff 0.5.0
$ uvx ruff --version
ruff 0.5.0
```

ただし、最新バージョンを明示的に要求することで、インストールされているバージョンを無視できます。例:

```console
$ uvx ruff@latest --version
0.6.2
```

または、`--isolated` フラグを使用すると、キャッシュの更新は行われませんが、インストールされているバージョンは無視されます:

```console
$ uvx --isolated ruff --version
0.6.2
```

`uv tool install` は、次のように `{package}@{version}` および `{package}@latest` 指定子も尊重します。

```console
$ uv tool install ruff@latest
$ uv tool install ruff@0.6.0
```

## ツールディレクトリ

デフォルトでは、uv ツール ディレクトリの名前は `tools` で、uv アプリケーション状態ディレクトリ (例: `~/.local/share/uv/tools`) にあります。場所は `UV_TOOL_DIR` 環境変数でカスタマイズできます。

ツールのインストール ディレクトリへのパスを表示するには:

```console
$ uv tool dir
```

ツール環境は、ツール パッケージと同じ名前のディレクトリ (例: `.../tools/<name>`) に配置されます。
!!! important

    ツール環境は直接変更されることを意図していません。たとえば、`pip` 操作を使用して、ツール環境を手動で変更しないことを強くお勧めします。

## ツールのアップグレード

ツール環境は、`uv tool upgrade` によってアップグレードすることも、後続の `uv tool install` 操作によって完全に再作成することもできます。

ツール環境内のすべてのパッケージをアップグレードするには

```console
$ uv tool upgrade black
```

ツール環境で単一のパッケージをアップグレードするには:

```console
$ uv tool upgrade black --upgrade-package click
```

ツールのアップグレードでは、ツールのインストール時に指定されたバージョン制約が尊重されます。たとえば、`uv tool install black >=23,<24` の後に `uv tool upgrade black` を実行すると、Black が `>=23,<24` の範囲内の最新バージョンにアップグレードされます。

代わりにバージョン制約を置き換えるには、`uv tool install` を使用してツールを再インストールします:

```console
$ uv tool install black>=24
```

同様に、ツールのアップグレードでは、ツールのインストール時に指定された設定が保持されます。たとえば、`uv tool install black --prerelease allow` の後に `uv tool upgrade black` を実行すると、`--prerelease allow` 設定が保持されます。

!!! note

    ツールをアップグレードすると、変更されていない場合でもツールの実行可能ファイルが再インストールされます。

アップグレード中にパッケージを再インストールするには、`--reinstall` および `--reinstall-package` オプションを使用します。

ツール環境内のすべてのパッケージを再インストールするには

```console
$ uv tool upgrade black --reinstall
```

ツール環境で単一のパッケージを再インストールするには:

```console
$ uv tool upgrade black --reinstall-package click
```

## 追加の依存関係を含める

ツールの実行中に追加のパッケージを含めることができます:

```console
$ uvx --with <extra-package> <tool>
```

また、ツールのインストール中にも可能です:

```console
$ uv tool install --with <extra-package> <tool-package>
```

追加のパッケージを含めるには、`--with` オプションを複数回指定できます。

`--with` オプションはパッケージ仕様をサポートしているため、特定のバージョンを要求できます:

```console
$ uvx --with <extra-package>==<version> <tool-package>
```

要求されたバージョンがツール パッケージの要件と競合する場合、パッケージの解決は失敗し、コマンドはエラーになります。

## ツールの実行ファイル

ツール実行可能ファイルには、すべてのコンソール エントリ ポイント、スクリプト エントリ ポイント、および Python パッケージによって提供されるバイナリ スクリプトが含まれます。ツール実行可能ファイルは、Unix では `bin` ディレクトリにシンボリック リンクされ、Windows ではコピーされます。

### `bin`ディレクトリ {#the-bin-directory}

実行ファイルは、XDG 標準に従ってユーザーの `bin` ディレクトリにインストールされます (例: `~/.local/bin`)。uv の他のディレクトリ スキームとは異なり、XDG 標準は、特に Windows と macOS を含むすべてのプラットフォームで使用されます。これらのプラットフォームには、実行ファイルを配置する明確な代替場所はありません。インストール ディレクトリは、使用可能な最初の環境変数から決定されます。

- `$UV_TOOL_BIN_DIR`
- `$XDG_BIN_HOME`
- `$XDG_DATA_HOME/../bin`
- `$HOME/.local/bin`

ツール パッケージの依存関係によって提供される実行可能ファイルはインストールされません。

### `PATH` {#the-path}

ツール実行ファイルをシェルから使用できるようにするには、`bin` ディレクトリが `PATH` 変数に含まれている必要があります。`PATH` に含まれていない場合は、警告が表示されます。`uv tool update-shell` コマンドを使用して、共通シェル設定ファイルの `PATH` に `bin` ディレクトリを追加できます。

### 実行ファイルの上書き

ツールをインストールしても、以前に uv によってインストールされなかった `bin` ディレクトリ内の実行可能ファイルは上書きされません。たとえば、`pipx` を使用してツールをインストールした場合、`uv tool install` は失敗します。`--force` フラグを使用すると、この動作を上書きできます。

## `uv run` との関係

呼び出し `uv tool run <name>` (または `uvx <name>`) は、次とほぼ同等です:

```console
$ uv run --no-project --with <name> -- <name>
```

ただし、uv のツール インターフェイスを使用する場合、いくつかの顕著な違いがあります。

- `--with` オプションは必要ありません。必要なパッケージはコマンド名から推測されます。
- 一時環境は専用の場所にキャッシュされます。
- `--no-project` フラグは必要ありません。ツールは常にプロジェクトから分離して実行されます。
- ツールがすでにインストールされている場合、`uv tool run` はインストールされているバージョンを使用しますが、`uv run` は使用しません。

ツールをプロジェクトから分離しない場合、たとえば `pytest` または `mypy` を実行する場合は、`uv tool run` ではなく `uv run` を使用する必要があります。
